var Ambilight=function(){function Ambilight(options){options=options||{};this.options=Object.assign({includeCSS:true},options);if(this.options.includeCSS){applyDefaultStyles()}}Ambilight.prototype.render=function(){var images=document.querySelectorAll("img[data-ambilight]");for(var i=0;i<images.length;i++)renderImage(images[i]);var videos=document.querySelectorAll("video[data-ambilight]");for(var i=0;i<videos.length;i++)renderVideo(videos[i])};Ambilight.prototype.discard=function(){var shadowElements=document.querySelectorAll(".ambilight__shadow");shadowElements.forEach(function(element){element.style.display="none"})};function renderVideo(videoElement){var element=videoElement;var container=document.createElement("div");container.className="ambilight__container";if(element.getAttribute("data-ambilight").length>0)container.id=element.getAttribute("data-ambilight");var visibleElement=element.cloneNode(true);visibleElement.classList.add("ambilight__visible");var shadowElement=document.createElement("canvas");shadowElement.className="ambilight__shadow";visibleElement.removeAttribute("data-ambilight");(function(video,canvas){var context=canvas.getContext("2d");var shouldRequestNewFrame=true;function mirrorCanvas(){context.clearRect(0,0,canvas.width,canvas.height);context.drawImage(video,0,0,canvas.width,canvas.height);if(shouldRequestNewFrame)window.requestAnimationFrame(mirrorCanvas)}video.onloadeddata=function(){window.requestAnimationFrame(mirrorCanvas)};video.onplay=function(){shouldRequestNewFrame=true;window.requestAnimationFrame(mirrorCanvas)};video.onpause=function(){shouldRequestNewFrame=false};video.onabort=function(){shouldRequestNewFrame=false}})(visibleElement,shadowElement);container.appendChild(visibleElement);container.appendChild(shadowElement);element.parentNode.insertBefore(container,element);element.parentNode.removeChild(element)}function renderImage(imgElement){var container=document.createElement("div");container.className="ambilight__container";if(imgElement.getAttribute("data-ambilight").length>0)container.id=imgElement.getAttribute("data-ambilight");var visibleElement=imgElement.cloneNode(true);visibleElement.classList.add("ambilight__visible");var shadowElement=document.createElement("img");shadowElement.className="ambilight__shadow";shadowElement.src=visibleElement.src;visibleElement.removeAttribute("data-ambilight");shadowElement.removeAttribute("data-ambilight");(function(visible,shadow){visibleElement.onload=function(){shadowElement.src=visibleElement.src}})(visibleElement,shadowElement);container.appendChild(visibleElement);container.appendChild(shadowElement);imgElement.parentNode.insertBefore(container,imgElement);imgElement.parentNode.removeChild(imgElement)}function applyStyles(element,styles){for(var item in styles){if(styles.hasOwnProperty(item)){element.style[item]=styles[item]}}}function applyDefaultStyles(){var defaultStyle="LmFtYmlsaWdodF9fY29udGFpbmVye3Bvc2l0aW9uOnJlbGF0aXZlfS5hbWJpbGlnaHRfX3Zpc2libGV7ZGlzcGxheTpibG9jaztwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjEwO3dpZHRoOjEwMCV9LmFtYmlsaWdodF9fc2hhZG93e2Rpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTt6LWluZGV4OjU7bGVmdDowO3RvcDowOy13ZWJraXQtZmlsdGVyOmJsdXIoNDVweCk7LW1vei1maWx0ZXI6Ymx1cig0NXB4KTstbXMtZmlsdGVyOmJsdXIoNDVweCk7ZmlsdGVyOmJsdXIoNDVweCl9";var styleEl=document.createElement("style");styleEl.textContent=atob(defaultStyle);var head=document.querySelector("head");head.appendChild(styleEl)}return Ambilight}();